#!/bin/bash
# Quick VPS Setup Guide for ChoyAI

echo "üöÄ ChoyAI VPS Quick Setup Guide"
echo "================================"

echo "1. Clone the repository:"
echo "   git clone https://github.com/shanchoynoor/ChoyAI.git"
echo "   cd ChoyAI"
echo ""

echo "2. Configure environment:"
echo "   cp .env .env.backup  # backup original"
echo "   nano .env  # edit with your API keys"
echo ""
echo "   # IMPORTANT: Fix configuration parsing"
echo "   git pull origin main  # Get latest fixes"
echo "   python test_config.py  # Test configuration"
echo ""

echo "3a. DOCKER METHOD (Recommended):"
echo "   # Install Docker if not installed:"
echo "   curl -fsSL https://get.docker.com | sh"
echo "   sudo usermod -aG docker \$USER"
echo "   sudo systemctl enable docker"
echo "   sudo systemctl start docker"
echo ""
echo "   # Run ChoyAI with Docker:"
echo "   cd config"
echo "   docker-compose up -d"
echo ""
echo "   # View logs:"
echo "   docker-compose logs -f choyai"
echo ""

echo "3b. PYTHON METHOD (Alternative):"
echo "   # Install Python dependencies:"
echo "   sudo apt update"
echo "   sudo apt install python3 python3-pip python3-venv -y"
echo ""
echo "   # Create virtual environment:"
echo "   python3 -m venv venv"
echo "   source venv/bin/activate"
echo ""
echo "   # Install requirements:"
echo "   pip install -r requirements.txt"
echo ""
echo "   # Initialize database:"
echo "   python tools/init_databases.py"
echo ""
echo "   # Run the application:"
echo "   python app/main.py"
echo ""

echo "4. Check health:"
echo "   python health.py"
echo ""

echo "5. Background service (for Python method):"
echo "   # Install screen or tmux:"
echo "   sudo apt install screen -y"
echo ""
echo "   # Run in background:"
echo "   screen -S choyai"
echo "   source venv/bin/activate"
echo "   python app/main.py"
echo "   # Press Ctrl+A, D to detach"
echo ""
echo "   # Reattach later:"
echo "   screen -r choyai"
echo ""

echo "üîß REQUIRED CONFIGURATION:"
echo "- Edit .env file with your:"
echo "  ‚Ä¢ TELEGRAM_BOT_TOKEN (from @BotFather)"
echo "  ‚Ä¢ DEEPSEEK_API_KEY (primary AI provider)"
echo "  ‚Ä¢ Other AI provider keys (optional)"
echo ""

echo "üìä MONITORING:"
echo "- Health check: python health.py"
echo "- Docker logs: docker-compose logs -f"
echo "- Python logs: tail -f data/logs/choyai.log"
echo ""

echo "‚úÖ PORTS:"
echo "- No external ports needed for Telegram bot (uses polling)"
echo "- Optional: 8000 for web interface"
echo "- Optional: 8080 for metrics"
echo ""

echo "üö® TROUBLESHOOTING:"
echo "If you get 'JSONDecodeError' or 'error parsing value' errors:"
echo ""
echo "1. Pull latest fixes:"
echo "   git pull origin main"
echo ""
echo "2. Test configuration:"
echo "   python test_config.py"
echo ""
echo "3. Check .env syntax - ensure no quotes around lists:"
echo "   ‚úÖ AVAILABLE_PERSONAS=choy,stark,rose"
echo "   ‚ùå AVAILABLE_PERSONAS=\"choy,stark,rose\""
echo ""
echo "4. If still failing, run the fix script:"
echo "   chmod +x fix_vps.sh"
echo "   ./fix_vps.sh"
echo ""
echo "5. Alternative: Download latest settings directly:"
echo "   curl -sSL https://raw.githubusercontent.com/shanchoynoor/ChoyAI/main/app/config/settings.py -o app/config/settings.py"
